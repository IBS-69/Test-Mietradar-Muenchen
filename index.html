<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MietRadar München</title>
    <meta name="description" content="Finde deine Traumwohnung in München mit MietRadar." />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: { sans: ['Inter', 'sans-serif'] },
            colors: {
              brand: {
                50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 900: '#1e3a8a',
              }
            }
          }
        }
      }
    </script>

    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Babel (Übersetzt React im Browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body { font-family: 'Inter', sans-serif; }
      html { scroll-behavior: smooth; }
      /* Hide number spinners */
      input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
      input[type=number] { -moz-appearance: textfield; }
      /* Custom Scrollbar */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      .dark ::-webkit-scrollbar-thumb { background: #475569; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">
    <div id="root"></div>

    <!-- Hier beginnt deine App -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            MapPin, Search, Home, Moon, Sun, Menu, X, CheckCircle, Filter, ArrowRight, Star, Heart, 
            ChevronLeft, ChevronRight, Mail, Phone, User, Lock, Facebook, Instagram, Twitter, Share2, 
            Maximize2, Upload, DollarSign, Shield, Zap, ImageOff, Eye, EyeOff, LockKeyhole, Send, CheckSquare, Info 
        } from 'https://esm.sh/lucide-react@0.263.1';

        // --- KONSTANTEN & DATEN ---
        
        const HERO_IMAGES = [
            { url: "https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?q=80&w=2070", alt: "München Hotel / Luxus" },
            { url: "https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?q=80&w=2053", alt: "Modernes Wohnzimmer" },
            { url: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=2070", alt: "Haus Fassade" },
            { url: "https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?q=80&w=2070", alt: "Küche Modern" }
        ];

        const REAL_ESTATE_IMAGES = [
            "https://images.unsplash.com/photo-1600596542815-3ad19e6f67e9?auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1600210492486-724fe5c67fb0?auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1600566752355-35792bedcfe1?auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1600585154526-990dced4db0d?auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1583608205776-bfd35f0d9f83?auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1560185127-6ed189bf02f4?auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1560185007-cde436f6a4d0?auto=format&fit=crop&w=800&q=80",
            "https://images.unsplash.com/photo-1560184897-ae75f418493e?auto=format&fit=crop&w=800&q=80"
        ];

        const DISTRICT_CENTERS = {
            "Allach-Untermenzing": { lat: 48.185, lng: 11.465 },
            "Altstadt-Lehel": { lat: 48.140, lng: 11.585 },
            "Aubing-Lochhausen-Langwied": { lat: 48.150, lng: 11.420 },
            "Au-Haidhausen": { lat: 48.128, lng: 11.600 },
            "Berg am Laim": { lat: 48.130, lng: 11.635 },
            "Bogenhausen": { lat: 48.155, lng: 11.620 },
            "Feldmoching-Hasenbergl": { lat: 48.210, lng: 11.550 },
            "Hadern": { lat: 48.115, lng: 11.485 },
            "Laim": { lat: 48.140, lng: 11.505 },
            "Ludwigsvorstadt-Isarvorstadt": { lat: 48.130, lng: 11.560 },
            "Maxvorstadt": { lat: 48.149, lng: 11.560 },
            "Milbertshofen-Am Hart": { lat: 48.190, lng: 11.570 },
            "Moosach": { lat: 48.180, lng: 11.510 },
            "Neuhausen-Nymphenburg": { lat: 48.158, lng: 11.525 },
            "Obergiesing": { lat: 48.115, lng: 11.595 },
            "Pasing-Obermenzing": { lat: 48.150, lng: 11.460 },
            "Ramersdorf-Perlach": { lat: 48.110, lng: 11.620 },
            "Schwabing-Freimann": { lat: 48.175, lng: 11.600 },
            "Schwabing-West": { lat: 48.165, lng: 11.570 },
            "Schwanthalerhöhe": { lat: 48.136, lng: 11.540 },
            "Sendling": { lat: 48.115, lng: 11.545 },
            "Sendling-Westpark": { lat: 48.120, lng: 11.520 },
            "Thalkirchen-Obersendling": { lat: 48.100, lng: 11.540 },
            "Trudering-Riem": { lat: 48.125, lng: 11.670 },
            "Untergiesing-Harlaching": { lat: 48.100, lng: 11.570 }
        };
        const DISTRICTS = Object.keys(DISTRICT_CENTERS).sort();

        // Hilfsfunktion für Bilder
        const getUniqueImages = (count) => {
            const shuffled = [...REAL_ESTATE_IMAGES].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        };

        // Mock Offers generieren
        const generateAllOffers = () => {
            let offers = [];
            let idCounter = 100;
            DISTRICTS.forEach(district => {
                const center = DISTRICT_CENTERS[district];
                const isExpensive = ["Bogenhausen", "Altstadt-Lehel", "Schwabing"].some(d => district.includes(d));
                const basePrice = isExpensive ? 1500 : 900;
                const rooms = Math.floor(Math.random() * 3) + 2;
                const size = rooms * 28 + Math.floor(Math.random() * 20);
                
                const uniqueImgs = getUniqueImages(5);
                
                offers.push({
                    id: idCounter++,
                    title: `${rooms}-Zimmer Wohnung in ${district}`,
                    price: basePrice + Math.floor(Math.random() * 600),
                    additionalCosts: 200,
                    size: size,
                    rooms: rooms,
                    district: district,
                    street: "Musterstraße",
                    zipCode: "80000",
                    lat: center.lat + (Math.random() - 0.5) * 0.015,
                    lng: center.lng + (Math.random() - 0.5) * 0.015,
                    image: uniqueImgs[0],
                    gallery: uniqueImgs.slice(1),
                    description: `Attraktive Wohnung in ${district}. Ideal geschnitten und ab sofort verfügbar.`,
                    amenities: ["Keller", "Einbauküche", "Balkon"],
                    contactName: "MietRadar Service",
                    isVerified: Math.random() > 0.7
                });
            });
            return offers;
        };
        const MOCK_OFFERS = generateAllOffers();
        
        const MOCK_CHATS = [
            {
                id: '1', partnerName: 'MietRadar Service', apartmentTitle: '2-Zimmer Wohnung in Schwabing',
                lastMessage: 'Besichtigungstermin bestätigt.', unreadCount: 1,
                messages: [
                    { id: 'm1', sender: 'me', text: 'Hallo, ist die Wohnung noch frei?', timestamp: new Date() },
                    { id: 'm2', sender: 'other', text: 'Besichtigungstermin bestätigt.', timestamp: new Date() }
                ]
            }
        ];

        // --- KOMPONENTEN ---

        const Navbar = ({ darkMode, toggleTheme, setView, currentView, isLoggedIn, onLogout, savedCount, unreadMessages }) => {
            const [isScrolled, setIsScrolled] = useState(false);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

            useEffect(() => {
                const handleScroll = () => setIsScrolled(window.scrollY > 10);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const isTransparentNav = !isScrolled && currentView === 'home';
            const textColor = isTransparentNav ? 'text-white' : 'text-gray-600 dark:text-gray-300';

            return (
                <nav className={`fixed top-0 w-full z-50 transition-all duration-300 ${!isTransparentNav ? 'bg-white/90 dark:bg-gray-900/90 backdrop-blur-md shadow-sm border-b border-gray-200 dark:border-gray-800' : 'bg-transparent'}`}>
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex justify-between items-center h-16">
                            <div className="flex items-center cursor-pointer gap-2" onClick={() => setView('home')}>
                                <div className="w-8 h-8 rounded-lg bg-brand-600 flex items-center justify-center text-white shadow-lg"><Home size={18} /></div>
                                <span className={`font-bold text-xl ${isTransparentNav ? 'text-white' : 'text-brand-900 dark:text-white'}`}>MietRadar</span>
                            </div>
                            <div className="hidden md:flex items-center gap-6">
                                <button onClick={() => setView('listings')} className={`font-medium hover:text-brand-600 ${textColor}`}>Wohnungen finden</button>
                                {isLoggedIn ? (
                                    <button onClick={() => setView('create-listing')} className={`font-medium hover:text-brand-600 ${textColor}`}>Inserat aufgeben</button>
                                ) : (
                                    <button onClick={() => setView('landlord-landing')} className={`font-medium hover:text-brand-600 ${textColor}`}>Für Vermieter</button>
                                )}
                                <div className="h-6 w-px bg-gray-300/50"></div>
                                <button onClick={toggleTheme} className={`p-2 rounded-full hover:bg-white/10 ${textColor}`}>{darkMode ? <Sun size={20} /> : <Moon size={20} />}</button>
                                {isLoggedIn ? (
                                    <div className="flex items-center gap-4">
                                        <button onClick={() => setView('favorites')} className={`relative p-2 ${textColor}`}><Heart size={20} />{savedCount > 0 && <span className="absolute top-1 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"></span>}</button>
                                        <button onClick={() => setView('messages')} className={`relative p-2 ${textColor}`}><Mail size={20} />{unreadMessages > 0 && <span className="absolute top-1 right-0 w-2.5 h-2.5 bg-blue-500 rounded-full border-2 border-white"></span>}</button>
                                        <button onClick={onLogout} className={`font-medium ${textColor}`}>Abmelden</button>
                                        <div className="w-8 h-8 rounded-full bg-brand-100 text-brand-600 flex items-center justify-center font-bold border-2 border-white">A</div>
                                    </div>
                                ) : (
                                    <div className="flex items-center gap-3">
                                        <button onClick={() => setView('login')} className={`font-medium hover:text-brand-600 ${textColor}`}>Anmelden</button>
                                        <button onClick={() => setView('register')} className={`px-5 py-2 rounded-full font-semibold text-sm ${isTransparentNav ? 'bg-white text-brand-700' : 'bg-brand-600 text-white'}`}>Registrieren</button>
                                    </div>
                                )}
                            </div>
                            <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className="md:hidden text-current"><Menu size={24} /></button>
                        </div>
                    </div>
                </nav>
            );
        };

        const HeroSection = ({ onSearch, setFilters }) => {
            const [index, setIndex] = useState(0);
            const [district, setDistrict] = useState("");
            
            useEffect(() => {
                const timer = setInterval(() => setIndex(i => (i + 1) % HERO_IMAGES.length), 5000);
                return () => clearInterval(timer);
            }, []);

            const handleSearch = () => {
                setFilters({ district: district, maxPrice: 5000, minRooms: 0, query: '' });
                onSearch();
            };

            return (
                <div className="relative h-[600px] md:h-[780px] w-full overflow-hidden flex items-center justify-center bg-gray-900">
                    <div className="absolute inset-0 z-0">
                        <img src={HERO_IMAGES[index].url} className="w-full h-full object-cover transition-all duration-1000" alt="Hero" />
                        <div className="absolute inset-0 bg-gradient-to-b from-black/60 via-black/30 to-gray-900/90"></div>
                    </div>
                    <div className="relative z-10 text-center px-4 max-w-4xl">
                        <div className="inline-flex items-center gap-2 px-4 py-1 rounded-full bg-white/20 backdrop-blur-md border border-white/20 text-white text-sm mb-6"><Star size={14} className="text-yellow-400" /> MietRadar: Deine #1 für München</div>
                        <h1 className="text-4xl md:text-6xl font-bold text-white mb-6 drop-shadow-xl">Zuhause finden in<br/><span className="text-blue-300">Deutschlands schönster Stadt</span></h1>
                        
                        <div className="bg-white p-2 rounded-2xl shadow-2xl max-w-xl mx-auto flex flex-col sm:flex-row gap-2 mt-10">
                            <div className="flex-grow relative">
                                <MapPin className="absolute left-3 top-3.5 text-gray-400" size={20} />
                                <select value={district} onChange={e => setDistrict(e.target.value)} className="w-full pl-10 pr-4 py-3 rounded-xl border-none bg-transparent focus:ring-0 text-gray-900">
                                    <option value="">Beliebiger Stadtteil</option>
                                    {DISTRICTS.map(d => <option key={d} value={d}>{d}</option>)}
                                </select>
                            </div>
                            <button onClick={handleSearch} className="bg-brand-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-brand-700 flex items-center justify-center gap-2"><Search size={20} /> Suchen</button>
                        </div>
                    </div>
                </div>
            );
        };

        const ListingCard = ({ item, onClick, isSaved, onToggleSave }) => {
            const [err, setErr] = useState(false);
            return (
                <div onClick={onClick} className="group bg-white dark:bg-gray-800 rounded-2xl border border-gray-100 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all cursor-pointer h-full flex flex-col">
                    <div className="relative h-56 bg-gray-200">
                        <img src={err ? "https://via.placeholder.com/400" : item.image} onError={() => setErr(true)} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                        <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                        <button onClick={(e) => { e.stopPropagation(); onToggleSave(); }} className={`absolute top-3 right-3 p-2 rounded-full ${isSaved ? 'bg-red-500 text-white' : 'bg-white/20 text-white hover:bg-white hover:text-red-500'}`}><Heart size={18} fill={isSaved ? "currentColor" : "none"} /></button>
                        <div className="absolute bottom-3 left-3 text-white"><p className="font-bold text-xl">{item.price} €</p><p className="text-xs opacity-90">{item.size} m² • {item.rooms} Zi.</p></div>
                    </div>
                    <div className="p-4 flex flex-col flex-grow">
                        <h3 className="font-bold text-gray-900 dark:text-white mb-1 line-clamp-1">{item.title}</h3>
                        <p className="text-sm text-gray-500 flex items-center gap-1 mb-3"><MapPin size={14}/> {item.district}</p>
                        <div className="mt-auto flex gap-2 flex-wrap">{item.amenities.slice(0,2).map((a,i) => <span key={i} className="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-gray-600 dark:text-gray-300">{a}</span>)}</div>
                    </div>
                </div>
            );
        };

        const PropertyDetails = ({ item, onBack, isSaved, onToggleSave, onContact }) => {
            const [msg, setMsg] = useState(`Guten Tag, ich interessiere mich für "${item.title}"...`);
            return (
                <div className="pt-24 pb-12 px-4 max-w-6xl mx-auto min-h-screen">
                    <button onClick={onBack} className="flex items-center text-sm text-gray-500 hover:text-brand-600 mb-4"><ChevronLeft size={16}/> Zurück zur Suche</button>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-1 h-[400px] rounded-2xl overflow-hidden mb-8">
                        <img src={item.image} className="w-full h-full object-cover" onError={(e) => e.target.src="https://via.placeholder.com/800"}/>
                        <div className="grid grid-cols-2 gap-1">
                            {item.gallery.slice(0,4).map((img, i) => <img key={i} src={img} className="w-full h-full object-cover" onError={(e) => e.target.src="https://via.placeholder.com/800"}/>)}
                        </div>
                    </div>
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div className="lg:col-span-2">
                            <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">{item.title}</h1>
                            <div className="flex items-center gap-4 text-gray-500 mb-6"><MapPin size={18}/> {item.district}</div>
                            <div className="grid grid-cols-3 gap-4 mb-8">
                                <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-xl text-center"><div className="font-bold text-xl dark:text-white">{item.price} €</div><div className="text-xs text-gray-500">Kaltmiete</div></div>
                                <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-xl text-center"><div className="font-bold text-xl dark:text-white">{item.size} m²</div><div className="text-xs text-gray-500">Fläche</div></div>
                                <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-xl text-center"><div className="font-bold text-xl dark:text-white">{item.rooms}</div><div className="text-xs text-gray-500">Zimmer</div></div>
                            </div>
                            <h3 className="font-bold text-lg dark:text-white mb-2">Beschreibung</h3>
                            <p className="text-gray-600 dark:text-gray-300 mb-8 whitespace-pre-line">{item.description}</p>
                        </div>
                        <div>
                            <div className="bg-white dark:bg-gray-800 p-6 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-lg sticky top-24">
                                <div className="font-bold text-lg dark:text-white mb-4">Anbieter kontaktieren</div>
                                <textarea value={msg} onChange={e => setMsg(e.target.value)} className="w-full p-3 rounded-lg border bg-gray-50 dark:bg-gray-900 dark:border-gray-600 text-sm mb-4" rows="4"></textarea>
                                <button onClick={() => onContact(msg)} className="w-full bg-brand-600 text-white font-bold py-3 rounded-xl hover:bg-brand-700">Nachricht senden</button>
                                <button onClick={onToggleSave} className={`w-full mt-3 py-3 rounded-xl border font-bold flex items-center justify-center gap-2 ${isSaved ? 'bg-red-50 border-red-200 text-red-600' : 'border-gray-200 text-gray-600 hover:bg-gray-50'}`}>
                                    <Heart size={20} fill={isSaved ? "currentColor" : "none"} /> {isSaved ? 'Gespeichert' : 'Merken'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const MapComponent = ({ apartments, onMarkerClick, selectedDistrict }) => {
            const mapRef = useRef(null);
            const mapInstance = useRef(null);

            useEffect(() => {
                if (!mapRef.current || mapInstance.current) return;
                if (!window.L) return;
                mapInstance.current = window.L.map(mapRef.current).setView([48.137, 11.576], 12);
                window.L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; OSM &copy; CARTO'
                }).addTo(mapInstance.current);
            }, []);

            useEffect(() => {
                if (!mapInstance.current) return;
                mapInstance.current.eachLayer((layer) => { if (layer instanceof window.L.Marker) mapInstance.current.removeLayer(layer); });
                
                if (selectedDistrict && DISTRICT_CENTERS[selectedDistrict]) {
                    mapInstance.current.flyTo([DISTRICT_CENTERS[selectedDistrict].lat, DISTRICT_CENTERS[selectedDistrict].lng], 14);
                } else {
                    mapInstance.current.invalidateSize();
                }

                apartments.forEach(apt => {
                    const icon = window.L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="background:white; color:#2563eb; padding:4px 8px; border-radius:6px; font-weight:bold; border:2px solid #2563eb; font-size:12px;">${apt.price}€</div>`
                    });
                    window.L.marker([apt.lat, apt.lng], {icon}).addTo(mapInstance.current).on('click', () => onMarkerClick(apt));
                });
            }, [apartments, selectedDistrict]);

            return <div ref={mapRef} className="h-full w-full bg-gray-100" />;
        };

        const ListingsPage = ({ filters, setFilters, apartments, onDetail, savedIds, onToggleSave }) => (
            <div className="pt-16 h-screen flex flex-col">
                <div className="bg-white dark:bg-gray-800 border-b dark:border-gray-700 p-4 z-20">
                    <div className="max-w-7xl mx-auto flex flex-wrap gap-3">
                        <input type="text" placeholder="Suchen..." value={filters.query} onChange={e=>setFilters({...filters, query:e.target.value})} className="flex-grow rounded-lg border-gray-300 dark:bg-gray-700 px-4 py-2"/>
                        <select value={filters.district} onChange={e=>setFilters({...filters, district:e.target.value})} className="rounded-lg border-gray-300 dark:bg-gray-700 px-4 py-2">
                            <option value="">Alle Stadtteile</option>
                            {DISTRICTS.map(d=><option key={d} value={d}>{d}</option>)}
                        </select>
                        <input type="number" placeholder="Zimmer ab" value={filters.minRooms} onChange={e=>setFilters({...filters, minRooms:Number(e.target.value)})} className="w-24 rounded-lg border-gray-300 dark:bg-gray-700 px-3 py-2"/>
                        <input type="number" placeholder="Max Preis" value={filters.maxPrice} onChange={e=>setFilters({...filters, maxPrice:Number(e.target.value)})} className="w-28 rounded-lg border-gray-300 dark:bg-gray-700 px-3 py-2"/>
                    </div>
                </div>
                <div className="flex-grow flex overflow-hidden">
                    <div className="w-full md:w-7/12 overflow-y-auto p-4 bg-gray-50 dark:bg-gray-900">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {apartments.map(apt => (
                                <div key={apt.id} className="h-[400px]">
                                    <ListingCard item={apt} onClick={()=>onDetail(apt)} isSaved={savedIds.includes(apt.id)} onToggleSave={()=>onToggleSave(apt.id)}/>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="hidden md:block w-5/12 relative">
                        <MapComponent apartments={apartments} onMarkerClick={onDetail} selectedDistrict={filters.district} />
                    </div>
                </div>
            </div>
        );

        const AuthPage = ({ type, setView, onLogin }) => {
            const [data, setData] = useState({ email: '', password: '', name: '', surname: '', confirm: '' });
            const [showPw, setShowPw] = useState(false);
            const [tos, setTos] = useState(false);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (type === 'login') {
                    if ((data.email === 'admin' && data.password === '123') || (data.email === 'admin@test.de' && data.password === '123')) {
                        onLogin(true);
                    } else {
                        onLogin(false);
                    }
                } else {
                    if (!tos) return alert("Bitte AGB akzeptieren");
                    onLogin(false);
                }
            };

            return (
                <div className="min-h-screen pt-20 flex items-center justify-center bg-gray-50 dark:bg-gray-900 px-4">
                    <div className="bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-xl w-full max-w-md border border-gray-100 dark:border-gray-700">
                        <h2 className="text-2xl font-bold mb-6 text-center dark:text-white">{type === 'login' ? 'Anmelden' : 'Konto erstellen'}</h2>
                        <div className="mb-6 bg-blue-50 text-blue-700 p-3 rounded flex gap-2 text-sm"><Shield size={16}/> Sicher & Verschlüsselt</div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            {type === 'register' && (
                                <div className="grid grid-cols-2 gap-4">
                                    <input required placeholder="Vorname" className="w-full p-2 border rounded" onChange={e=>setData({...data, name:e.target.value})}/>
                                    <input required placeholder="Nachname" className="w-full p-2 border rounded" onChange={e=>setData({...data, surname:e.target.value})}/>
                                </div>
                            )}
                            <input required placeholder={type === 'login' ? "E-Mail oder Benutzer (admin)" : "E-Mail"} className="w-full p-2 border rounded" onChange={e=>setData({...data, email:e.target.value})}/>
                            <div className="relative">
                                <input type={showPw ? "text" : "password"} required placeholder="Passwort (123)" className="w-full p-2 border rounded" onChange={e=>setData({...data, password:e.target.value})}/>
                                <button type="button" onClick={()=>setShowPw(!showPw)} className="absolute right-3 top-2.5 text-gray-400">{showPw ? <EyeOff size={18}/> : <Eye size={18}/>}</button>
                            </div>
                            {type === 'register' && (
                                <>
                                    <input type="password" required placeholder="Passwort wiederholen" className="w-full p-2 border rounded" onChange={e=>setData({...data, confirm:e.target.value})}/>
                                    <label className="flex gap-2 text-sm"><input type="checkbox" checked={tos} onChange={e=>setTos(e.target.checked)}/> Ich akzeptiere die <span className="text-brand-600 cursor-pointer" onClick={()=>setView('legal')}>AGB</span></label>
                                </>
                            )}
                            <button className="w-full bg-brand-600 text-white font-bold py-3 rounded-lg hover:bg-brand-700">{type === 'login' ? 'Einloggen' : 'Registrieren'}</button>
                        </form>
                        <div className="mt-4 text-center text-sm"><button onClick={()=>setView(type==='login'?'register':'login')} className="text-brand-600 hover:underline">{type === 'login' ? 'Konto erstellen' : 'Anmelden'}</button></div>
                    </div>
                </div>
            );
        };

        const CreateListing = ({ onCancel, onSubmit }) => {
            const [step, setStep] = useState(1);
            const [imgs, setImgs] = useState([]);
            
            const handleImg = (e) => {
                if (e.target.files) {
                    const urls = Array.from(e.target.files).map(f => URL.createObjectURL(f));
                    setImgs([...imgs, ...urls]);
                }
            };

            return (
                <div className="pt-24 pb-12 px-4 min-h-screen bg-gray-50 dark:bg-gray-900">
                    <div className="max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow p-8">
                        <div className="flex justify-between mb-8 text-sm font-bold text-gray-400">
                            <span className={step>=1?'text-brand-600':''}>1. Eckdaten</span>
                            <span className={step>=2?'text-brand-600':''}>2. Details</span>
                            <span className={step>=3?'text-brand-600':''}>3. Fertig</span>
                        </div>
                        {step === 1 && (
                            <div className="space-y-4">
                                <h2 className="text-xl font-bold dark:text-white">Eckdaten der Immobilie</h2>
                                <p className="text-sm text-gray-500">Felder mit * sind Pflichtfelder.</p>
                                <input placeholder="Titel *" className="w-full p-3 border rounded dark:bg-gray-900 dark:text-white"/>
                                <div className="grid grid-cols-2 gap-4">
                                    <input type="number" placeholder="Kaltmiete (€) *" className="w-full p-3 border rounded dark:bg-gray-900 dark:text-white"/>
                                    <input type="number" placeholder="Größe (m²) *" className="w-full p-3 border rounded dark:bg-gray-900 dark:text-white"/>
                                </div>
                                <select className="w-full p-3 border rounded dark:bg-gray-900 dark:text-white">
                                    <option>Stadtteil wählen...</option>
                                    {DISTRICTS.map(d=><option key={d}>{d}</option>)}
                                </select>
                            </div>
                        )}
                        {step === 2 && (
                            <div className="space-y-4">
                                <h2 className="text-xl font-bold dark:text-white">Bilder & Beschreibung</h2>
                                <textarea rows="5" placeholder="Beschreibung..." className="w-full p-3 border rounded dark:bg-gray-900 dark:text-white"></textarea>
                                <div className="grid grid-cols-4 gap-2">
                                    {imgs.map((src,i) => <img key={i} src={src} className="w-full h-20 object-cover rounded"/>)}
                                    <label className="border-2 border-dashed rounded flex items-center justify-center h-20 cursor-pointer hover:bg-gray-50"><Upload/><input type="file" multiple hidden onChange={handleImg}/></label>
                                </div>
                            </div>
                        )}
                        {step === 3 && (
                            <div className="text-center py-10">
                                <CheckCircle size={60} className="mx-auto text-green-500 mb-4"/>
                                <h2 className="text-2xl font-bold dark:text-white">Bereit zum Veröffentlichen</h2>
                                <p className="text-gray-500 mb-6">Ihr Inserat wurde erstellt und wird geprüft.</p>
                            </div>
                        )}
                        <div className="flex justify-between mt-8">
                            <button onClick={step===1?onCancel:()=>setStep(s=>s-1)} className="text-gray-500">Zurück</button>
                            <button onClick={step===3?onSubmit:()=>setStep(s=>s+1)} className="bg-brand-600 text-white px-6 py-2 rounded-lg font-bold">{step===3?'Kostenlos inserieren':'Weiter'}</button>
                        </div>
                    </div>
                </div>
            );
        };

        const Footer = ({ setView }) => (
            <footer className="bg-white dark:bg-gray-900 border-t dark:border-gray-800 pt-12 pb-8">
                <div className="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8 text-sm text-gray-500">
                    <div>
                        <div className="font-bold text-xl text-brand-900 dark:text-white mb-4 flex gap-2"><Home/> MietRadar</div>
                        <p>Die moderne Plattform für München.</p>
                    </div>
                    <div>
                        <h4 className="font-bold text-gray-900 dark:text-white mb-4">Rechtliches</h4>
                        <ul className="space-y-2">
                            <li><button onClick={()=>setView('legal')} className="hover:text-brand-600">Impressum</button></li>
                            <li><button onClick={()=>setView('legal')} className="hover:text-brand-600">Datenschutz</button></li>
                            <li><button onClick={()=>setView('legal')} className="hover:text-brand-600">AGB</button></li>
                        </ul>
                    </div>
                </div>
                <div className="text-center mt-8 pt-8 border-t text-xs text-gray-400">© 2025 MietRadar München. Studentisches Projekt.</div>
            </footer>
        );

        const LegalPage = () => (
            <div className="pt-24 pb-12 max-w-4xl mx-auto px-4 min-h-screen">
                <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mb-8"><p className="font-bold text-blue-800">Projektarbeit – Studenten der FOM München</p></div>
                <h1 className="text-3xl font-bold mb-8 dark:text-white">Impressum & Rechtliches</h1>
                <div className="bg-white dark:bg-gray-800 p-8 rounded shadow space-y-6">
                    <div><h2 className="font-bold text-xl">Angaben gemäß § 5 TMG</h2><p>Christian Falkner<br/>Student der FOM Hochschule<br/>München</p></div>
                    <div><h2 className="font-bold text-xl">Kontakt</h2><p>Email: webmaster@falkner.info</p></div>
                    <div><h2 className="font-bold text-xl">Haftungsausschluss</h2><p>Dies ist ein Demo-Projekt. Keine echten Angebote.</p></div>
                </div>
            </div>
        );

        // --- APP MAIN ---

        const App = () => {
            const [view, setView] = useState('home');
            const [darkMode, setDarkMode] = useState(false);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [savedIds, setSavedIds] = useState([]);
            const [filters, setFilters] = useState({ district: '', maxPrice: 5000, minRooms: 0, query: '' });
            const [selectedApt, setSelectedApt] = useState(null);

            const toggleTheme = () => {
                setDarkMode(!darkMode);
                document.documentElement.classList.toggle('dark');
            };

            const filtered = useMemo(() => MOCK_OFFERS.filter(a => {
                return (a.title.toLowerCase().includes(filters.query.toLowerCase()) || a.district.toLowerCase().includes(filters.query.toLowerCase()))
                && a.price <= filters.maxPrice && a.rooms >= filters.minRooms && (filters.district ? a.district === filters.district : true);
            }), [filters]);

            return (
                <div className="min-h-screen flex flex-col bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
                    <Navbar {...{darkMode, toggleTheme, setView, currentView: view, isLoggedIn, onLogout: ()=>setIsLoggedIn(false), savedCount: savedIds.length, unreadMessages: 0}} />
                    
                    {view === 'home' && <HeroSection onSearch={()=>setView('listings')} setFilters={setFilters} />}
                    {view === 'listings' && <ListingsPage filters={filters} setFilters={setFilters} apartments={filtered} onDetail={(a)=>{setSelectedApt(a);setView('details')}} savedIds={savedIds} onToggleSave={(id)=>setSavedIds(p=>p.includes(id)?p.filter(x=>x!==id):[...p,id])} />}
                    {view === 'details' && selectedApt && <PropertyDetails item={selectedApt} onBack={()=>setView('listings')} isSaved={savedIds.includes(selectedApt.id)} onToggleSave={()=>setSavedIds(p=>p.includes(selectedApt.id)?p.filter(x=>x!==selectedApt.id):[...p,selectedApt.id])} onContact={()=>alert("Nachricht gesendet!")} />}
                    {(view === 'login' || view === 'register') && <AuthPage type={view} setView={setView} onLogin={(admin)=>{setIsLoggedIn(true); if(admin) setView('create-listing'); else setView('home');}} />}
                    {view === 'create-listing' && <CreateListing onCancel={()=>setView('home')} onSubmit={()=>{alert("Inseriert!");setView('home')}} />}
                    {view === 'legal' && <LegalPage />}
                    {view === 'landlord-landing' && <div className="pt-32 text-center"><h1 className="text-4xl font-bold mb-4">Vermieter werden</h1><button onClick={()=>setView('register')} className="bg-brand-600 text-white px-8 py-3 rounded font-bold">Jetzt registrieren</button></div>}
                    {view === 'favorites' && <div className="pt-24 px-4 max-w-7xl mx-auto"><h1 className="text-3xl font-bold mb-8">Merkzettel</h1><div className="grid grid-cols-3 gap-6">{MOCK_OFFERS.filter(a=>savedIds.includes(a.id)).map(a=><div key={a.id} className="h-96"><ListingCard item={a} onClick={()=>{setSelectedApt(a);setView('details')}} isSaved={true} onToggleSave={()=>setSavedIds(p=>p.filter(x=>x!==a.id))}/></div>)}</div></div>}
                    
                    {view !== 'listings' && view !== 'messages' && <Footer setView={setView} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
